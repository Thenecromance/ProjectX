#pragma once

#ifndef INJECTION_H
#define INJECTION_H

#include <Windows.h>
#include <fstream>
#include <TlHelp32.h>
#include <Psapi.h>
#include "NT Stuff.h"

enum INJECTION_MODE
{
	IM_LoadLibrary,
	IM_LdrLoadDll,
	IM_ManualMap,
};

#define INJ_ERASE_HEADER 1
#define INJ_FAKE_HEADER 2
#define INJ_UNLINK_FROM_PEB 4
#define INJ_FLAGS_ALL (INJ_ERASE_HEADER | INJ_FAKE_HEADER | INJ_UNLINK_FROM_PEB)

HMODULE get_module_address(HANDLE hProc, const char* moduleName);
DWORD InjectDLL(const char * szDllFile, HANDLE hProc, INJECTION_MODE Mode, bool HijackThread = false, DWORD Postinjection = 0, DWORD * ErrorCode = nullptr);

#define INJ_ERR_SUCCESS					0x00000000
#define INJ_ERR_INVALID_PROC_HANDLE		0x00000001
#define INJ_ERR_FILE_DOESNT_EXIST		0x00000002
#define INJ_ERR_OUT_OF_MEMORY			0x00000003
#define INJ_ERR_INVALID_FILE			0x00000004
#define INJ_ERR_NO_X64FILE				0x00000005
#define INJ_ERR_NO_X86FILE				0x00000006
#define INJ_ERR_IMAGE_CANT_RELOC		0x00000007
#define INJ_ERR_NTDLL_MISSING			0x00000008
#define INJ_ERR_LDRLOADDLL_MISSING		0x00000009
#define INJ_ERR_LDRPLOADDLL_MISSING		0x0000000A
#define INJ_ERR_INVALID_FLAGS			0x0000000B
#define INJ_ERR_CANT_FIND_MOD			0x0000000C
#define INJ_ERR_CANT_FIND_MOD_PEB		0x0000000D

#define INJ_ERR_UNKNOWN					0x80000000
#define INJ_ERR_CANT_CREATE_THREAD		0x80000001
#define INJ_ERR_CANT_ALLOC_MEM			0x80000002
#define INJ_ERR_WPM_FAIL				0x80000003
#define INJ_ERR_TH32_FAIL				0x80000004
#define INJ_ERR_CANT_GET_PEB			0x80000005

#define INJ_ERR_ADV_UNKNOWN				0x00000000
#define INJ_ERR_ADV_INV_PROC			0x00000001
#define INJ_ERR_ADV_TH32_FAIL			0x00000002
#define INJ_ERR_ADV_NO_THREADS			0x00000003
#define INJ_ERR_ADV_CANT_OPEN_THREAD	0x00000004
#define INJ_ERR_ADV_SUSPEND_FAIL		0x00000005
#define INJ_ERR_ADV_GET_CONTEXT_FAIL	0x00000006
#define INJ_ERR_ADV_OUT_OF_MEMORY		0x00000007
#define INJ_ERR_ADV_WPM_FAIL			0x00000008
#define INJ_ERR_ADV_SET_CONTEXT_FAIL	0x00000009
#define INJ_ERR_ADV_RESUME_FAIL			0x0000000A
#define INJ_ERR_ADV_QIP_MISSING			0x0000000B
#define INJ_ERR_ADV_QIP_FAIL			0x0000000C

#endif